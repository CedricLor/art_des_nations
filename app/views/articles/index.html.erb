<% content_for :title, t(:article_admin_index_title, default: "Articles admin index") %>

<% provide :admin_nav_content_actions do %>
  <li><%= link_to t(:admin_nav_new_content, default: 'New'), new_article_path %></li>
<% end %>

<%#= react_component('NewsIndexPage', { articles: @articles } ) %>
<div class="container">
  <h1>Listing articles</h1>

  <%= link_to t('.new_article'), new_article_path %>


  <%# DRAFTS %>
  <% draft_articles = @articles.select{|a| a.status == "draft" } %>
  <h3><%= t(:draft, default: "Brouillons", count: draft_articles.count).capitalize %></h3>
  <table class="table table-striped">
    <tr>
      <th>Id</th>
      <th><%= t(:titre, default: "Titre") %></th>
      <th><%= t(:author, default: "Auteur") %></th>
      <th><%= t(:posted_at, default: "Date de publication") %></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>

  <% draft_articles.each do |article| %>
    <tr>
      <td><%= article.id %></td>
      <td><%= article.title %></td>
      <td><%= article.author.full_name %></td>
      <td><%= l(article.posted_at, format: :long) %></td>
      <td><%= link_to t(:admin_nav_show_content, default: 'Voir'), article %></td>
      <td>
        <%# FIXME -- This does not belong to the view logic %>
        <% if ArticleUpdateForm.new(id: article.id, status: "published").valid? %>
          <%= link_to t(:publish, default: 'Publier').capitalize, article_path(id: article.id, article: {id: article.id, status: "published"}), method: :patch %>
        <% end %>
      </td>
      <td>
        <% if ArticleUpdateForm.new(id: article.id, status: "featured").valid? %>
          <%= link_to t(:feature, default: 'A la une').capitalize, article_path(id: article.id, article: {id: article.id, status: "featured"}), method: :patch %>
        <% end %>
      </td>
      <td><%= link_to t(:admin_nav_edit_content, default: 'Editer'), edit_article_path(article) %></td>
      <td><%= link_to t(:admin_nav_delete_content, default: 'Effacer'), article, method: :delete, data: { confirm: t(:deletion_confirmation, this_item: @this_item_i18n_name, default: "Are you sure you want to delete #{@this_item_i18n_name}?") } %></td>
    </tr>
  <% end %>
  </table>

  <br />

  <%# FEATURED %>
  <% featured_articles = @articles.select{|a| a.status == "featured" } %>
  <h3><%= t(:feature, default: "A la une", count: draft_articles.count).capitalize %></h3>
  <table class="table table-striped">
    <tr>
      <th>Id</th>
      <th><%= t(:titre, default: "Titre") %></th>
      <th><%= t(:author, default: "Auteur") %></th>
      <th><%= t(:posted_at, default: "Date de publication") %></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>

  <% featured_articles.each do |article| %>
    <tr>
      <td><%= article.id %></td>
      <td><%= article.title %></td>
      <td><%= article.author.full_name %></td>
      <td><%= l(article.posted_at, format: :long) %></td>
      <td><%= link_to t(:admin_nav_show_content, default: 'Voir'), article %></td>
      <td>
        <%= link_to t(:publish, default: 'Publier').capitalize, article_path(id: article.id, article: {id: article.id, status: "published"}), method: :patch %>
      </td>
      <td>
        <%= link_to t(:archive, default: 'Archiver').capitalize, article_path(id: article.id, article: {id: article.id, status: "archived"}), method: :patch %>
      </td>
      <td><%= link_to t(:admin_nav_edit_content, default: 'Editer'), edit_article_path(article) %></td>
      <td><%= link_to t(:admin_nav_delete_content, default: 'Effacer'), article, method: :delete, data: { confirm: t(:deletion_confirmation, this_item: @this_item_i18n_name, default: "Are you sure you want to delete #{@this_item_i18n_name}?") } %></td>
    </tr>
  <% end %>
  </table>

  <br />


  <%# PUBLISHED %>
  <% published_articles = @articles.select{|a| a.status == "published" } %>
  <h3><%= t(:published, default: "Publiés", count: draft_articles.count).capitalize %></h3>
  <table class="table table-striped">
    <tr>
      <th>Id</th>
      <th><%= t(:titre, default: "Titre") %></th>
      <th><%= t(:author, default: "Auteur") %></th>
      <th><%= t(:posted_at, default: "Date de publication") %></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>

  <% published_articles.each do |article| %>
    <tr>
      <td><%= article.id %></td>
      <td><%= article.title %></td>
      <td><%= article.author.full_name %></td>
      <td><%= l(article.posted_at, format: :long) %></td>
      <td><%= link_to t(:admin_nav_show_content, default: 'Voir'), article %></td>
      <td>
        <%= link_to t(:feature, default: 'A la une').capitalize, article_path(id: article.id, article: {id: article.id, status: "featured"}), method: :patch %>
      </td>
      <td>
        <%= link_to t(:archive, default: 'Archiver').capitalize, article_path(id: article.id, article: {id: article.id, status: "archived"}), method: :patch %>
      </td>
      <td><%= link_to t(:admin_nav_edit_content, default: 'Editer'), edit_article_path(article) %></td>
      <td><%= link_to t(:admin_nav_delete_content, default: 'Effacer'), article, method: :delete, data: { confirm: t(:deletion_confirmation, this_item: @this_item_i18n_name, default: "Are you sure you want to delete #{@this_item_i18n_name}?") } %></td>
    </tr>
  <% end %>
  </table>

  <br />


  <%# ARCHIVED %>
  <% published_articles = @articles.select{|a| a.status == "archived" } %>
  <h3><%= t(:archived, default: "Archivé(e)s", count: draft_articles.count).capitalize %></h3>
  <table class="table table-striped">
    <tr>
      <th>Id</th>
      <th><%= t(:titre, default: "Titre") %></th>
      <th><%= t(:author, default: "Auteur") %></th>
      <th><%= t(:posted_at, default: "Date de publication") %></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>

  <% published_articles.each do |article| %>
    <tr>
      <td><%= article.id %></td>
      <td><%= article.title %></td>
      <td><%= article.author.full_name %></td>
      <td><%= l(article.posted_at, format: :long) %></td>
      <td><%= link_to t(:admin_nav_show_content, default: 'Voir'), article %></td>
      <td><%= link_to t(:admin_nav_edit_content, default: 'Editer'), edit_article_path(article) %></td>
      <td><%= link_to t(:admin_nav_delete_content, default: 'Effacer'), article, method: :delete, data: { confirm: t(:deletion_confirmation, this_item: @this_item_i18n_name, default: "Are you sure you want to delete #{@this_item_i18n_name}?") } %></td>
    </tr>
  <% end %>
  </table>

  <br />

  <%# TRANSLATION STATUS %>
  <h3><%= t(:translation_status, default: "Etat des traductions").capitalize %></h3>
  <table class="table table-striped">
    <tr>
      <th>Id</th>
      <th><%= t(:titre, default: "Titre") %></th>
      <th class="text-center"><%= "Traductions existantes" %></th>
      <th colspan="4" class="text-center"><%= "Traduire" %></th>
    </tr>

  <% @articles.each do |article| %>
    <% languages = article.translations.map { |at| at.locale.to_s } %>
    <tr>
      <td><%= article.id %></td>
      <td><%= article.title %></td>
      <td class="text-center">
        <%= languages.join(" ") %>
      </td>
      <% @languages_array.each do | locale | %>
        <td>
          <%= link_to t("in_#{locale.values[0]}", default: "en #{locale.values[0]}"), params.merge({:locale => locale.keys[0], :action => languages.include?(locale.keys[0].to_s) ? "show" : "edit", :id => article.id}) %>
        </td>
      <% end %>
    </tr>
  <% end %>
  </table>
</div>
