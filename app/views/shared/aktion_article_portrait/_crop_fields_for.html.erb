<%# media_containers/_crop_form.html.erb %>


<% content_for :after_js do %>
  <%= javascript_tag do -%>
    var cropBox = function() {
      $(<%= "cropbox_#{index}" %>).Jcrop({
        onChange: update_crop,
        onSelect: update_crop,
        aspectRatio: <%= width %> / <%= height %>
      });
    };

    var ratio = <%#= media_container.media_geometry(:original).width %>1 / 2<%#= media_container.media_geometry(:for_slider).width %>;

    function update_crop(coords){

      $("<%= "##{id_builder}_crop_x" %>").val(Math.round(coords.x * ratio));
      $("<%= "##{id_builder}_crop_y" %>").val(Math.round(coords.y * ratio));
      $("<%= "##{id_builder}_crop_w" %>").val(Math.round(coords.w * ratio));
      $("<%= "##{id_builder}_crop_h" %>").val(Math.round(coords.h * ratio));
/*
      $("#crop_x").val(Math.round(coords.x * ratio));
      $("#crop_y").val(Math.round(coords.y * ratio));
      $("#crop_w").val(Math.round(coords.w * ratio));
      $("#crop_h").val(Math.round(coords.h * ratio));
*/
    };

    cropBox();
  <% end -%>
<% end %>

<%= image_tag media_container.media.url(:for_slider), alt: media_container.title, id: "cropbox_#{index}" %>

<%= fields_for media_container do |f| %>
  <% [:crop_x, :crop_y, :crop_h, :crop_w].each do |attribute| %>
    <%= f.hidden_field attribute, id: "#{id_builder}_#{attribute}", name: "#{name_builder}[#{attribute.to_s}]" %>
  <% end %>
<% end %>
