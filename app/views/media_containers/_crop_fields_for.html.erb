<%# media_containers/_crop_form.html.erb %>


<% content_for :after_js do %>
  <%= javascript_tag do -%>
    var cropBox = function() {
      $('#cropbox').Jcrop({
        onChange: update_crop,
        onSelect: update_crop,
        aspectRatio: <%= width %> / <%= height %>
      });
    };

    var ratio = <%= media_container.media_geometry(:original).width %> / <%= media_container.media_geometry(:for_slider).width %>;

    function update_crop(coords){

      $("#crop_x").val(Math.round(coords.x * ratio));
      $("#crop_y").val(Math.round(coords.y * ratio));
      $("#crop_w").val(Math.round(coords.w * ratio));
      $("#crop_h").val(Math.round(coords.h * ratio));
    };

    cropBox();
  <% end -%>
<% end %>

<%= image_tag media_container.media.url(:for_slider), alt: media_container.title, id: "cropbox" %>

<%= fields_for media_container do |f| %>
  <% [:crop_x, :crop_y, :crop_h, :crop_w].each do |attribute| %>
    <%= f.hidden_field attribute, id: attribute, name: "media_containers[#{index}][#{attribute.to_s}]" %>
  <% end %>
  <p><%= f.submit "Crop" %></p>
<% end %>
